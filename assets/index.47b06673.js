(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();const b=document.querySelector("#star-count"),w=document.querySelector("#form"),g=document.querySelector("#comp-id"),l=document.querySelector("#passwords"),d=document.querySelector("#sort"),p=document.querySelector("#copy"),h={"2x2x2":"222","3x3x3":"333","4x4x4":"444","5x5x5":"555","6x6x6":"666","7x7x7":"777","3x3x3 Blindfolded":"333bf","3x3x3 Fewest Moves":"333fm","3x3x3 One-Handed":"333oh",Clock:"clock",Megaminx:"minx",Pyraminx:"pyram",Skewb:"skewb","Square-1":"sq1","4x4x4 Blindfolded":"444bf","5x5x5 Blindfolded":"555bf","3x3x3 Multiple Blindfolded":"333mbf"},m={222:"2x2",333:"3x3",444:"4x4",555:"5x5",666:"6x6",777:"7x7","333bf":"3BLD","333fm":"FMC","333oh":"OH",clock:"Clock",minx:"Mega",pyram:"Pyra",skewb:"Skewb",sq1:"SQ-1","444bf":"4BLD","555bf":"5BLD","333mbf":"MBLD"};function S(t){var e;if(!t||t.length<3)return null;const[s,i]=t.split("-");if(!Object.keys(m).includes(s))return null;const r=(e=parseInt(i.substring(1)))!=null?e:null;return r==null||isNaN(r)?null:{event:s,roundId:r}}function k(t){const s=t.indexOf(" Round");if(s===-1)return;const i=t.substring(0,s),r=t.substring(s+7,s+8),e=h[i],o=m[e],c=parseInt(r);return!e||!o||!c?void 0:{password:o+" R"+t.substring(s+7).replace(" Scramble Set "," ").replace(" Attempt ","-A"),event:e,round:c}}async function I(t){const s=`https://cors-proxy.simonkellly.workers.dev?https://worldcubeassociation.org/api/v0/competitions/${t}/wcif/public`,i=await fetch(s,{});if(!i.ok){console.log(i);return}const r=await i.json();if(!!E(r))return r}function E(t){return!(!t||!t.schedule||!t.events)}async function P(){var f;const t=g.value.replace(/\s/g,""),s=await I(t);if(!s)return alert("Error fetching competition details"),!1;const i=l.value,e=((f=s.schedule.venues)==null?void 0:f.flatMap(n=>n.rooms).flatMap(n=>n.activities)).sort((n,u)=>Date.parse(n.startTime)-Date.parse(u.startTime)).map(n=>S(n.activityCode)).filter(n=>n),c=i.split(`
`).filter(n=>n).map(n=>k(n)).filter(n=>!!n).sort((n,u)=>{const y=e.findIndex(a=>a.event===n.event&&a.roundId===n.round),v=e.findIndex(a=>a.event===u.event&&a.roundId===u.round);return y-v}).map(n=>n.password);return l.value=c.join(`\r
`),!0}function x(){const t=!l.value.includes("SECRET SCRAMBLE SET PASSCODES");return l.setCustomValidity(t?"":"Please only paste the passwords not the descriptive text at the top of the file"),t}l.onkeyup=x;d.onclick=async()=>{const t=x();if(!w.checkValidity()||!t){alert("Please enter a valid competition ID and passwords");return}d.classList.add("loading","btn-disabled"),d.disabled=!0;const s=await P();d.classList.remove("loading","btn-disabled"),d.disabled=!1,s&&p.classList.remove("hidden")};p.onclick=()=>{navigator.clipboard.writeText(l.value)};(async()=>{const s=await(await fetch("https://api.github.com/repos/simonkellly/scramble-organizer")).json();b.innerText=s.stargazers_count})();
